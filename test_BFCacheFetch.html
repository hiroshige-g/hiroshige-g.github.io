<body>
<style>div {border: 1px solid black; }</style>
<a href="https://www.google.com" target="_top">Navigate to Google</a>
<pre id="pre">
</pre>
<script>
function log(div, text) {
  div.appendChild(document.createTextNode(text + '\n'));
  div.appendChild(document.createElement('br'));
}

function runTest(description) {
  const div = document.createElement('div');
  document.body.appendChild(div);

  log(div, description);
  const img = document.createElement('img');
  img.src = 'https://www.chromium.org/_/rsrc/1438879449147/config/customLogo.gif?revision=3&' + Math.random();
  div.appendChild(img);
  log(div, '');

  log(div, 'Fetch started');
  window.promise = fetch('/?' + Math.random());
  window.promise
    .then(() => { log(div, "Fetch done"); })
    .catch(() => { log(div, "Fetch Rejected"); });
}

window.addEventListener(
    'pageshow',
    (event) => {
      if (event.persisted) {
        runTest('pageshow');
        Promise.resolve().then(() => runTest('resolve after pageshow'));
        setTimeout(() => runTest('setTimeout(0) after pageshow'), 0);
        setTimeout(() => runTest('setTimeout(100) after pageshow'), 100);
      }
    });
window.addEventListener(
    'pagehide',
    () => { log("============ pagehide ===================="); }
);

</script>
